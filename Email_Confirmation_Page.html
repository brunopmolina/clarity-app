<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... (keep existing head and styles) ... -->
</head>
<body>
    <div class="container">
        <div id="loading">
            <h1>Verifying Your Email</h1>
            <div class="spinner"></div>
            <p>Please wait while we verify your email address...</p>
        </div>
        <div id="success" style="display: none;">
            <h1>Email Verified!</h1>
            <p>Your email has been successfully verified. You can now use the Clarity app.</p>
            <a href="clarity://login-callback" class="button">Open Clarity App</a>
        </div>
        <div id="error" style="display: none;">
            <h1>Verification Failed</h1>
            <p>There was a problem verifying your email. Please try again or contact support.</p>
            <a href="clarity://login-callback" class="button">Return to App</a>
        </div>
    </div>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');
        const type = urlParams.get('type');
        const redirectTo = urlParams.get('redirect_to');

        setTimeout(() => {
            const verifyUrl = `https://aayozsyiwnfdmavmlgwg.supabase.co/auth/v1/verify?token=${token}&type=${type}&redirect_to=${redirectTo}`;
            
            fetch(verifyUrl, {
                redirect: 'manual' // Don't automatically follow redirects
            })
                .then(response => {
                    document.getElementById('loading').style.display = 'none';
                    // Consider both 2xx and 3xx status codes as success
                    if (response.ok || (response.status >= 300 && response.status < 400)) {
                        document.getElementById('success').style.display = 'block';
                    } else {
                        document.getElementById('error').style.display = 'block';
                    }
                })
                .catch(error => {
                    // If we get a redirect error, that's actually success
                    if (error.name === 'TypeError' && error.message.includes('redirect')) {
                        document.getElementById('loading').style.display = 'none';
                        document.getElementById('success').style.display = 'block';
                    } else {
                        document.getElementById('loading').style.display = 'none';
                        document.getElementById('error').style.display = 'block';
                        console.error('Error:', error);
                    }
                });
        }, 1000);
    </script>
</body>
</html>
